<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Baroud Services - Home</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root{ --bg:#0b1424; --glass:rgba(255,255,255,.06); --stroke:rgba(255,255,255,.08); --blue:#1bc7ff; }
    body{ margin:0; font-family:sans-serif; background:var(--bg); color:#fff; }
    .wrap{ max-width:1200px; margin:0 auto; padding:20px; }
    .topbar{ display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
    .balancePill{ background:var(--glass); border:1px solid var(--stroke); padding:8px 15px; border-radius:15px; display:flex; gap:10px; align-items:center; }
    .grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap:15px; }
    .tile{ background:var(--glass); border:1px solid var(--stroke); border-radius:20px; overflow:hidden; cursor:pointer; text-align:center; transition:0.3s; }
    .tile:hover{ transform:translateY(-5px); border-color:var(--blue); }
    .tile img{ width:100%; height:140px; object-fit:cover; }
    .label{ padding:12px; font-weight:bold; }
    .addBtn{ background:linear-gradient(90deg,#0aa0ff,#2a74ff); border:none; color:#fff; padding:5px 10px; border-radius:8px; cursor:pointer; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="balancePill">
        <span>Balance: $<span id="uBalTop">0.00</span></span>
        <button class="addBtn" onclick="location.href='add-credit.html'">+</button>
      </div>
      <img src="assets/logo.png" style="height:40px;">
    </div>

    <div class="grid" id="products-grid">
      </div>
  </div>

  <script>
    const SUPABASE_URL = "https://pqrwitolonhfbfwtsnde.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBxcndpdG9sb25oZmJmd3RzbmRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc0NjQyNTcsImV4cCI6MjA4MzA0MDI1N30.N-OqDDDOz1wJnKfmOFAtwlH00m_oJvUKEQvbygVeujQ";
    const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function init() {
        // 1. جلب الرصيد
        const { data: bal } = await sb.rpc("get_my_balance");
        if(bal !== null) document.getElementById("uBalTop").textContent = Number(bal).toFixed(2);

        // 2. جلب المنتجات
        const { data: prods, error } = await sb.from('products').select('*').eq('active', true);
        const grid = document.getElementById('products-grid');

        if (error || !prods || prods.length === 0) {
            grid.innerHTML = "<p>No services found. Add some from Supabase dashboard.</p>";
            return;
        }

        grid.innerHTML = prods.map(p => `
            <div class="tile" onclick="location.href='order-details.html?id=${p.id}'">
                <img src="assets/products/${p.id}.jpg" onerror="this.src='assets/products/default.png'">
                <div class="label">${p.title}</div>
            </div>
        `).join('');
    }

    init();
  </script>
</body>
</html>
